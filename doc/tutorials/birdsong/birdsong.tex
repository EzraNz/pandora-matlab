%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University/School Laboratory Report
% LaTeX Template
% Version 3.1 (25/3/14)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Linux and Unix Users Group at Virginia Tech Wiki 
% (https://vtluug.org/wiki/Example_LaTeX_chem_lab_report)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{article}

\usepackage[version=3]{mhchem} % Package for chemical equation typesetting
\usepackage{siunitx} % Provides the \SI{}{} and \si{} command for typesetting SI units
\usepackage{graphicx} % Required for the inclusion of images
\usepackage{natbib} % Required to change bibliography style to APA
\usepackage{amsmath} % Required for some math elements 
\usepackage{courier}

\setlength\parindent{0pt} % Removes all indentation from paragraphs

\renewcommand{\labelenumi}{\alph{enumi}.} % Make numbering in the enumerate environment by letter rather than number (e.g. section 6)

%\usepackage{times} % Uncomment to use the Times New Roman font

\usepackage{wasysym}
\usepackage{hyperref}

\setlength{\marginparwidth}{1.2in}
\let\oldmarginpar\marginpar
\renewcommand\marginpar[1]{\-\oldmarginpar[\raggedleft #1]%
{\raggedright #1}}    

\newenvironment{checklist}{%
  \begin{list}{}{}% whatever you want the list to be
  \let\olditem\item
  \renewcommand\item{\olditem -- \marginpar{$\Box$} }
  \newcommand\checkeditem{\olditem -- \marginpar{$\CheckedBox$} }
}{%
  \end{list}
}

\usepackage{listings}
\usepackage{color} %red, green, blue, yellow, cyan, magenta, black, white
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

\begin{document}

\lstset{language=Matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------

\section{Objective}

This tutorial will help familiarize you with some of the capabilities of the Pandora toolbox. In it, I will be creating a database of birdsong syllables, then running some basic operations on it.

\subsection{Get Pandora}

\begin{checklist}
	\item		If you don't already have it, download Pandora from \url{software.incf.org/software/pandora/download} Under "Downloads \& Documentation," click on "PANDORA Toolbox v1.3b" (ZIP)". Save this file somewhere relevant.
	\item		Make sure the Pandora folders "classes" and "functions" are in your MATLAB path. Only include those directories; don't include anything inside of them.
\end{checklist}

\subsection{Before Getting Started}

\begin{checklist}
	\item		Get some data that you are interested in looking at. For this tutorial, the data will be birdsong syllables. The data can be any set of stuff that has something you're interested in looking at.
	\item		Think about the kinds of attributes that you want to look at in the data. For this example, we'll be looking at spectral entropy for each syllable.
\end{checklist}

\section{Creating a Database}

First, we'll load all the files into a database. In this case, the files I'm using are ".mat" files with the attribute "sonogram" attached. Before loading the files in, I'd like to find the spectral entropy of the sonogram, then store each file, along with its identifying attributes, in the database.\\

Creating a database requires two steps. First, we need to create a "dataset" object. A dataset is an abstract base class for keeping information about what is in the database separate from the actual database. Items can be added to or removed from the dataset without adding or removing elements of the database.\\

There can be different implementations of datasets. For this tutorial, we're going to use the "fileset" object, which keeps track of what files we want to add to the database.\\

\textbf{Note} Methods in Pandora use the structure \texttt{method\_name(param1, param2, ..., params)}, where \texttt{params1, params2, ...} are the necessary arguments for the method, and \texttt{params} is a structure containing keyword arguments, similar to Python. For example, to call the method \texttt{params\_tests\_fileset}, I might do \texttt{params\_tests\_fileset('*.mat', 1/32000, 1, struct('key', 'value'))}. In this case, the argument \texttt{params} is the structure \texttt{struct('key', 'value')}. This passes the argument \texttt{value} to the variable \texttt{key}. If nothing is specified, it uses the default value for that parameter.

\subsection{Creating a Dataset from a Group of Files}

A fileset object finds all the files whose names match a particular pattern and loads them in. The constructor method for creating a fileset is \texttt{params\_tests\_fileset(file\_pattern, dt, dy, id, params)}. The parameters are as follows:\\

\begin{checklist}
	\item		\texttt{file\_pattern} The pattern for which files to load. For example, if you want to load all the \texttt{.mat} files in a directory, this argument could be \texttt{'*.mat'}.
	\item		\texttt{dt} The time resolution of the data. For example, the song data I am using is sampled at 32000 Hz, so I would use the value \texttt{1/32000}.
	\item		\texttt{dy} The y-axis resolution of the data. For this example, I am just going to put \texttt{1}.
	\item		\texttt{id} Some identifier for the fileset.
	\item		\texttt{params} Extra arguments. Run \texttt{help params\_tests\_fileset} for a complete list.
\end{checklist}

In this tutorial, the way files are loaded is important. There are two optional parameters that we need to pass:

\begin{checklist}
	\item		\texttt{fileParamsRegexp} The pattern for extracting information from the filename. We need to get two groups: \texttt{name} and \texttt{val}. For example, my filenames use the pattern \texttt{parameter-value}, so I would pass \texttt{(?<name>onset)-(?<val>\d+)}.
	\item		\texttt{loadItemProfileFunc} If you want to change how files are loaded into the dataset, pass a custom function handle. This function needs to accept the parameters \texttt{dataset, index, param\_row} and \texttt{props}. The function should return a \texttt{results\_profile} object. A sample function is below.
\end{checklist}

Sample function passed to \texttt{loadItemProfileFunc}:

\lstinputlisting{functions/birdsong_mat_profile.m}

\subsection{Creating a Database from a Dataset}

Once the dataset has been specified, it is very simple to create a database. This can be done using the command \texttt{params\_tests\_db(my\_data\_set)}. This creates our database, which we can manipulate with Pandora.\\

Here is the sample code for this tutorial.

\lstinputlisting{functions/setupptf.m}

\section{Visualizing Data}

Now that all of the data is in a database, we need to use it for something.

\subsection{Selecting Data}

In the database, each datapoint has three attributes: \texttt{onset}, \texttt{entropy} and \texttt{ItemIndex}. The first two attributes were defined by the user, and the third is a unique index. Each attribute is a column in the database, and each row is a datapoint. Selecting data is done using MatLab's matrix notation.\\

To select the first 10 data points in the database:

\lstinputlisting{functions/selectingdata2.m}

To select particular attributes, both the attribute's name as a string or the attribute's value relative to the other attributes can be used:

\lstinputlisting{functions/selectingdata.m}

\end{document}
